<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ReviseFlow â€¢ Tasks</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{
  --bg:#0b1020;
  --panel:rgba(255,255,255,.06);
  --border:rgba(255,255,255,.14);
  --text:rgba(255,255,255,.92);
  --muted:rgba(255,255,255,.66);
  --brand:#8ea2ff;
  --good:#46e6b3;
  --warn:#ffd36e;
  --bad:#ff7b8f;
}

body{
  margin:0;
  font-family:system-ui;
  background:var(--bg);
  color:var(--text);
  padding:30px;
}

h1{
  font-size:24px;
  margin-bottom:20px;
}

.card{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:18px;
  padding:20px;
  margin-bottom:20px;
}

input,select,textarea{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid var(--border);
  background:transparent;
  color:var(--text);
}

button{
  padding:10px 14px;
  border-radius:10px;
  border:none;
  cursor:pointer;
  background:linear-gradient(135deg,var(--brand),var(--good));
  font-weight:600;
}

.task{
  padding:15px;
  border-radius:14px;
  border:1px solid var(--border);
  margin-bottom:10px;
  transition:0.2s;
}

.task.overdue{
  border-color:var(--bad);
  box-shadow:0 0 12px rgba(255,123,143,.3);
}

.task.done{
  opacity:.6;
  text-decoration:line-through;
}

.small{font-size:12px;color:var(--muted);}
.row{display:flex;gap:10px;flex-wrap:wrap;}
</style>
</head>
<body>

<h1>ðŸ“‹ Advanced Task Manager</h1>

<div class="card">
  <div class="row">
    <input id="taskTitle" placeholder="Task title">
    <select id="taskPriority">
      <option value="low">Low</option>
      <option value="medium">Medium</option>
      <option value="high">High</option>
    </select>
    <input type="date" id="taskDue">
  </div>
  <div style="margin-top:10px;">
    <textarea id="taskNotes" placeholder="Optional notes"></textarea>
  </div>
  <div style="margin-top:10px;">
    <button onclick="addTask()">Create Task</button>
  </div>
</div>

<div id="taskList"></div>

<script>
const supabase = window.supabase.createClient(
  "https://mgpwknnbhaljsscsvucm.supabase.co",
  "sb_publishable_6tdnozSH6Ck75uDgXPN-sg_Mn7vyLFs"
);

let tasks = [];

async function loadTasks(){
  const { data: { session } } = await supabase.auth.getSession();
  if(!session){
    window.location.href = "auth.html";
    return;
  }

  const { data } = await supabase
    .from("user_tasks")
    .select("*")
    .eq("user_id", session.user.id)
    .order("created_at", { ascending:false });

  tasks = data || [];
  renderTasks();
}

async function addTask(){
  const { data: { session } } = await supabase.auth.getSession();
  const title = document.getElementById("taskTitle").value.trim();
  if(!title) return;

  await supabase.from("user_tasks").insert({
    user_id: session.user.id,
    title,
    priority: document.getElementById("taskPriority").value,
    due_date: document.getElementById("taskDue").value || null,
    notes: document.getElementById("taskNotes").value
  });

  document.getElementById("taskTitle").value="";
  document.getElementById("taskNotes").value="";
  loadTasks();
}

async function toggleDone(id, done){
  await supabase.from("user_tasks")
    .update({ done: !done })
    .eq("id", id);
  loadTasks();
}

async function deleteTask(id){
  await supabase.from("user_tasks")
    .delete()
    .eq("id", id);
  loadTasks();
}

function renderTasks(){
  const list = document.getElementById("taskList");
  list.innerHTML="";

  const today = new Date().toISOString().split("T")[0];

  tasks.forEach(t=>{
    const div = document.createElement("div");
    div.className="task";
    if(t.done) div.classList.add("done");
    if(t.due_date && t.due_date < today && !t.done) div.classList.add("overdue");

    div.innerHTML = `
      <strong>${t.title}</strong>
      <div class="small">
        Priority: ${t.priority} 
        ${t.due_date ? "â€¢ Due: "+t.due_date : ""}
      </div>
      ${t.notes ? `<div class="small">${t.notes}</div>` : ""}
      <div style="margin-top:8px;">
        <button onclick="toggleDone('${t.id}', ${t.done})">
          ${t.done ? "Undo" : "Complete"}
        </button>
        <button onclick="deleteTask('${t.id}')">Delete</button>
      </div>
    `;
    list.appendChild(div);
  });
}

loadTasks();
</script>

</body>
</html>