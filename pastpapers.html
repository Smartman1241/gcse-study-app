<!doctype html>
<html lang="en">
<head>
<script src="theme.js"></script>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>GCSE Focus ‚Äì AQA Past Papers</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{
  --bg:#0b1020;
  --glass:rgba(255,255,255,.08);
  --border:rgba(255,255,255,.15);
  --text:rgba(255,255,255,.92);
  --brand:#8ea2ff;
}

html[data-theme="light"]{
  --bg:#f5f7ff;
  --glass:rgba(0,0,0,.05);
  --border:rgba(0,0,0,.15);
  --text:rgba(0,0,0,.88);
}

body{
  margin:0;
  min-height:100vh;
  font-family:system-ui;
  background:
    radial-gradient(1000px 600px at 15% 10%, rgba(142,162,255,.25), transparent 60%),
    radial-gradient(900px 500px at 85% 20%, rgba(70,230,179,.18), transparent 55%),
    radial-gradient(900px 500px at 70% 90%, rgba(255,211,110,.14), transparent 55%),
    var(--bg);
  display:flex;
  justify-content:center;
  align-items:center;
  color:var(--text);
}

.container{
  width:100%;
  max-width:700px;
  padding:30px;
}

.card{
  backdrop-filter:blur(20px);
  background:var(--glass);
  border:1px solid var(--border);
  border-radius:22px;
  padding:40px;
  box-shadow:0 20px 60px rgba(0,0,0,.35);
}

h1{
  text-align:center;
  margin-bottom:30px;
  font-size:28px;
}

label{
  display:block;
  margin-top:18px;
  font-weight:600;
}

select{
  width:100%;
  padding:12px;
  margin-top:8px;
  border-radius:12px;
  border:1px solid var(--border);
  background:var(--glass);
  color:var(--text);
  font-size:15px;
}

select option{
  background:var(--bg);
  color:var(--text);
}

button{
  width:100%;
  padding:14px;
  margin-top:25px;
  border-radius:14px;
  border:none;
  background:var(--brand);
  font-weight:700;
  cursor:pointer;
  font-size:15px;
}

.back{
  background:var(--glass);
  margin-top:15px;
}

.results{
  margin-top:30px;
  padding:20px;
  border-radius:16px;
  background:var(--glass);
  border:1px solid var(--border);
}

a{
  display:block;
  margin-top:12px;
  color:var(--brand);
  font-weight:600;
  text-decoration:none;
}
</style>
</head>

<body>

<div class="container">
  <div class="card">

    <h1>AQA Past Papers</h1>

    <label>Subject</label>
    <select id="subject" onchange="updatePaperOptions(); updateTierOptions();">
      <option value="English Language">English Language</option>
      <option value="English Literature">English Literature</option>
      <option value="Biology">Biology</option>
      <option value="Chemistry">Chemistry</option>
      <option value="Physics">Physics</option>
      <option value="Maths">Maths</option>
    </select>

    <label>Paper</label>
    <select id="paper"></select>

    <label>Tier</label>
    <select id="tier"></select>

    <label>Year</label>
    <select id="year">
      <option value="2024">2024</option>
      <option value="2023">2023</option>
      <option value="2022">2022</option>
      <option value="2021">2021</option>
      <option value="2020">2020</option>
      <option value="2019">2019</option>
      <option value="2018">2018</option>
    </select>

    <button onclick="findPaper()">Find Paper</button>

    <div class="results" id="results" style="display:none;"></div>

    <button class="back" onclick="window.location.href='index.html'">
      ‚Üê Back to Dashboard
    </button>

  </div>
</div>

<script>
const SUPABASE_URL = "https://mgpwknnbhaljsscsvucm.supabase.co";
const SUPABASE_KEY = "sb_publishable_6tdnozSH6Ck75uDgXPN-sg_Mn7vyLFs";
const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

function safeHttpsUrl(value){
  try{
    const u = new URL(String(value || ""));
    if(u.protocol !== "https:") return null;
    return u;
  }catch{
    return null;
  }
}


function updatePaperOptions(){
  const subject = document.getElementById("subject").value;
  const paperSelect = document.getElementById("paper");
  paperSelect.innerHTML = "";

  if(subject === "Maths"){
    paperSelect.innerHTML = `
      <option value="Paper 1 Non Calculator">Paper 1 Non Calculator</option>
      <option value="Paper 2 Calculator">Paper 2 Calculator</option>
      <option value="Paper 3 Calculator">Paper 3 Calculator</option>
    `;
  } else {
    paperSelect.innerHTML = `
      <option value="Paper 1">Paper 1</option>
      <option value="Paper 2">Paper 2</option>
    `;
  }
}

function updateTierOptions(){
  const subject = document.getElementById("subject").value;
  const tierSelect = document.getElementById("tier");
  tierSelect.innerHTML = "";

  if(subject === "English Language" || subject === "English Literature"){
    tierSelect.innerHTML = `<option value="N/A">N/A</option>`;
  } else {
    tierSelect.innerHTML = `
      <option value="Foundation">Foundation</option>
      <option value="Higher">Higher</option>
    `;
  }
}

async function findPaper(){

  const subject = document.getElementById("subject").value;
  const paper_type = document.getElementById("paper").value;
  const tier = document.getElementById("tier").value;
  const year = parseInt(document.getElementById("year").value);

  const results = document.getElementById("results");
  results.style.display = "block";
  results.innerHTML = "Searching...";

  const { data, error } = await supabaseClient
    .from("past_papers")
    .select("*")
    .eq("subject", subject)
    .eq("paper_type", paper_type)
    .eq("tier", tier)
    .eq("year", year)
    .single();

  if(error || !data){
    results.innerHTML = "Paper not found in database.";
    return;
  }

  const qUrl = safeHttpsUrl(data.question_link);
  const mUrl = safeHttpsUrl(data.markscheme_link);

  if(!qUrl || !mUrl){
    results.textContent = "Paper found but links are invalid.";
    return;
  }

  results.innerHTML = "";

  const title = document.createElement("h3");
  title.textContent = `${year} ${subject} - ${paper_type} (${tier})`;

  const qLink = document.createElement("a");
  qLink.href = qUrl.href;
  qLink.target = "_blank";
  qLink.rel = "noopener noreferrer";
  qLink.textContent = "üìÑ View Official Paper";

  const mLink = document.createElement("a");
  mLink.href = mUrl.href;
  mLink.target = "_blank";
  mLink.rel = "noopener noreferrer";
  mLink.textContent = "üìù View Mark Scheme";

  results.appendChild(title);
  results.appendChild(qLink);
  results.appendChild(mLink);
}

updatePaperOptions();
updateTierOptions();
</script>

</body>
</html>