<!doctype html>
<html lang="en" data-theme="dark">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ReviseFlow — Study Sets</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{
  --bg:#0b1020;
  --panel:rgba(255,255,255,.06);
  --border:rgba(255,255,255,.12);
  --text:rgba(255,255,255,.92);
  --muted:rgba(255,255,255,.65);
  --brand:#8ea2ff;
  --good:#46e6b3;
  --radius:18px;
}

body{
  margin:0;
  font-family: system-ui,-apple-system,Segoe UI,Roboto;
  background:var(--bg);
  color:var(--text);
}

.wrap{
  max-width:1100px;
  margin:0 auto;
  padding:30px 20px 60px;
}

h1{margin:0 0 8px;}
.subtitle{color:var(--muted); margin-bottom:30px;}

.grid{
  display:grid;
  grid-template-columns: 1fr 2fr;
  gap:24px;
}

@media(max-width:900px){
  .grid{grid-template-columns:1fr;}
}

.panel{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:20px;
}

input, select, textarea{
  width:100%;
  padding:10px 12px;
  margin-bottom:14px;
  border-radius:12px;
  border:1px solid var(--border);
  background:transparent;
  color:var(--text);
}

button{
  padding:10px 14px;
  border-radius:12px;
  border:none;
  cursor:pointer;
}

.btn-primary{
  background:linear-gradient(135deg,var(--brand),var(--good));
  color:#111;
  font-weight:600;
}

.set-card{
  border:1px solid var(--border);
  border-radius:16px;
  padding:16px;
  margin-bottom:14px;
  background:rgba(255,255,255,.04);
  transition:.15s;
}

.set-card:hover{
  transform:translateY(-2px);
}

.set-top{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.badge{
  font-size:12px;
  padding:4px 8px;
  border-radius:999px;
  background:rgba(142,162,255,.2);
}

.actions{
  margin-top:12px;
  display:flex;
  gap:10px;
}

.btn-small{
  padding:6px 10px;
  font-size:13px;
}
</style>
</head>

<body>
<div class="wrap">
  <h1>Study Sets</h1>
  <div class="subtitle">Create and manage your revision sets.</div>

  <div class="grid">

    <!-- CREATE PANEL -->
    <div class="panel">
      <h3>Create New Set</h3>
      <input id="setName" placeholder="Set name (e.g. Biology – Cells)" />
      <input id="setSubject" placeholder="Subject (e.g. Biology)" />
      <textarea id="setDesc" placeholder="Description (optional)"></textarea>
      <button class="btn-primary" id="btnCreate">Create Set</button>
    </div>

    <!-- LIST PANEL -->
    <div class="panel">
      <h3>Your Sets</h3>
      <div id="setsList"></div>
    </div>

  </div>
</div>

<script>
const SUPABASE_URL = "https://mgpwknnbhaljsscsvucm.supabase.co";
const SUPABASE_KEY = "sb_publishable_6tdnozSH6Ck75uDgXPN-sg_Mn7vyLFs";
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

let currentUser = null;

async function init(){
  const { data:{ session } } = await supabase.auth.getSession();
  if(!session){
    window.location.href = "auth.html";
    return;
  }
  currentUser = session.user;
  loadSets();
}

async function loadSets(){
  const { data, error } = await supabase
    .from("study_sets")
    .select("*")
    .eq("user_id", currentUser.id)
    .order("updated_at",{ascending:false});

  if(error){
    console.error(error);
    return;
  }

  const list = document.getElementById("setsList");
  list.innerHTML = "";

  if(!data.length){
    list.innerHTML = "<p>No study sets yet.</p>";
    return;
  }

  data.forEach(set=>{
    const div = document.createElement("div");
    div.className="set-card";
    div.innerHTML=`
      <div class="set-top">
        <strong>${set.name}</strong>
        <span class="badge">${set.subject}</span>
      </div>
      <div style="margin-top:6px;color:var(--muted)">
        ${set.description || ""}
      </div>
      <div class="actions">
        <button class="btn-small" onclick="deleteSet('${set.id}')">Delete</button>
      </div>
    `;
    list.appendChild(div);
  });
}

async function createSet(){
  const name = document.getElementById("setName").value.trim();
  const subject = document.getElementById("setSubject").value.trim();
  const desc = document.getElementById("setDesc").value.trim();

  if(!name) return alert("Enter a name");

  const { error } = await supabase
    .from("study_sets")
    .insert({
      user_id: currentUser.id,
      name,
      subject,
      description: desc,
      created_at:new Date(),
      updated_at:new Date()
    });

  if(error){
    console.error(error);
    return;
  }

  document.getElementById("setName").value="";
  document.getElementById("setSubject").value="";
  document.getElementById("setDesc").value="";

  loadSets();
}

async function deleteSet(id){
  if(!confirm("Delete this set?")) return;

  await supabase
    .from("study_sets")
    .delete()
    .eq("id",id);

  loadSets();
}

document.getElementById("btnCreate").addEventListener("click",createSet);

init();
</script>
</body>
</html>